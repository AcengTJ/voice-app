<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voice Group Chat</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 800px;
        overflow: hidden;
        animation: slideUp 0.6s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 30px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 50%
        );
        animation: rotate 20s linear infinite;
      }

      @keyframes rotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
        position: relative;
        z-index: 1;
      }

      .login-section {
        padding: 40px;
        text-align: center;
      }

      .login-section.hidden {
        display: none;
      }

      .input-group {
        margin: 30px 0;
      }

      .input-group input {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid #e1e5e9;
        border-radius: 50px;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.8);
      }

      .input-group input:focus {
        outline: none;
        border-color: #4facfe;
        background: white;
        box-shadow: 0 0 20px rgba(79, 172, 254, 0.2);
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 50px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .btn:active {
        transform: translateY(0);
      }

      .chat-section {
        display: none;
        padding: 30px;
      }

      .chat-section.active {
        display: block;
      }

      .participants {
        margin-bottom: 30px;
      }

      .participants h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.3rem;
      }

      .participant-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
      }

      .participant {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .participant:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .participant.speaking {
        animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(245, 87, 108, 0.7);
        }
        50% {
          box-shadow: 0 0 0 20px rgba(245, 87, 108, 0);
        }
      }

      .participant-name {
        font-weight: bold;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      .participant-status {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .voice-controls {
        background: rgba(0, 0, 0, 0.05);
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        margin-top: 30px;
      }

      .voice-btn {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: none;
        margin: 0 15px;
        font-size: 2rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
      }

      .mic-btn {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
      }

      .mic-btn.muted {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      }

      .speaker-btn.muted {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      }

      .voice-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .leave-btn {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        cursor: pointer;
        margin-top: 20px;
        transition: all 0.3s ease;
      }

      .leave-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .status-indicator {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #38ef7d;
      }

      .status-indicator.muted {
        background: #ff6b6b;
      }

      .messages {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        max-height: 200px;
        overflow-y: auto;
      }

      .message {
        padding: 10px;
        margin: 5px 0;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.7);
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .participant-list {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 10px;
        }

        .voice-btn {
          width: 60px;
          height: 60px;
          font-size: 1.5rem;
          margin: 0 10px;
        }

        .container {
          border-radius: 15px;
        }
      }

      .connection-status {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px 20px;
        border-radius: 25px;
        color: white;
        font-weight: bold;
        z-index: 1000;
        transition: all 0.3s ease;
      }

      .connection-status.connected {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }

      .connection-status.disconnected {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      }
    </style>
  </head>
  <body>
    <div class="connection-status disconnected" id="connectionStatus">
      Offline
    </div>

    <div class="container">
      <div class="header">
        <h1>üéôÔ∏è Voice Group Chat</h1>
        <p>Bergabunglah dalam percakapan suara bersama teman-teman</p>
      </div>

      <div class="login-section" id="loginSection">
        <div class="input-group">
          <input
            type="text"
            id="usernameInput"
            placeholder="Masukkan nama Anda..."
            maxlength="20"
          />
        </div>
        <button class="btn" onclick="joinChat()">Bergabung ke Room</button>
      </div>

      <div class="chat-section" id="chatSection">
        <div class="participants">
          <h3>Peserta Online (<span id="participantCount">0</span>)</h3>
          <div class="participant-list" id="participantList"></div>
        </div>

        <div class="messages" id="messages">
          <div class="message">
            Selamat datang di Voice Group Chat! Klik tombol mikrofon untuk mulai
            berbicara.
          </div>
        </div>

        <div class="voice-controls">
          <button class="voice-btn mic-btn" id="micBtn" onclick="toggleMic()">
            üé§
          </button>
          <button
            class="voice-btn"
            id="speakerBtn"
            onclick="toggleSpeaker()"
            style="
              background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            "
          >
            üîä
          </button>
          <br />
          <button class="leave-btn" onclick="leaveChat()">
            Keluar dari Room
          </button>
        </div>
      </div>
    </div>

    <script>
      class VoiceGroupChat {
        constructor() {
          this.participants = new Map();
          this.currentUser = null;
          this.isMuted = true;
          this.isSpeakerOn = true;
          this.mediaRecorder = null;
          this.audioChunks = [];
          this.isRecording = false;
          this.init();
        }

        init() {
          this.updateConnectionStatus("disconnected");
          // Simulate connection after 2 seconds
          setTimeout(() => {
            this.updateConnectionStatus("connected");
          }, 2000);
        }

        updateConnectionStatus(status) {
          const statusEl = document.getElementById("connectionStatus");
          statusEl.className = `connection-status ${status}`;
          statusEl.textContent = status === "connected" ? "Online" : "Offline";
        }

        addMessage(message, type = "system") {
          const messagesEl = document.getElementById("messages");
          const messageEl = document.createElement("div");
          messageEl.className = "message";
          messageEl.innerHTML = `<strong>${new Date().toLocaleTimeString(
            "id-ID"
          )}</strong> - ${message}`;
          messagesEl.appendChild(messageEl);
          messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        joinChat(username) {
          this.currentUser = {
            id: Date.now(),
            name: username,
            isMuted: true,
            joinTime: new Date(),
          };

          this.participants.set(this.currentUser.id, this.currentUser);

          document.getElementById("loginSection").classList.add("hidden");
          document.getElementById("chatSection").classList.add("active");

          this.updateParticipantList();
          this.addMessage(`${username} bergabung ke room`);

          this.requestMicrophoneAccess();
        }

        addDemoParticipants() {
          // Demo participants removed - only show real users
        }

        simulateSpeaking(participantId) {
          const participantEl = document.querySelector(
            `[data-participant-id="${participantId}"]`
          );
          if (participantEl) {
            participantEl.classList.add("speaking");
            setTimeout(() => {
              participantEl.classList.remove("speaking");
            }, 1500);
          }
        }

        async requestMicrophoneAccess() {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({
              audio: true,
            });
            this.setupAudioRecording(stream);
            this.addMessage(
              "Mikrofon berhasil diakses. Anda siap untuk berbicara!"
            );
          } catch (error) {
            this.addMessage(
              "Tidak dapat mengakses mikrofon. Pastikan Anda memberikan izin.",
              "error"
            );
            console.error("Microphone access denied:", error);
          }
        }

        setupAudioRecording(stream) {
          this.mediaRecorder = new MediaRecorder(stream);

          this.mediaRecorder.ondataavailable = (event) => {
            this.audioChunks.push(event.data);
          };

          this.mediaRecorder.onstop = () => {
            const audioBlob = new Blob(this.audioChunks, { type: "audio/wav" });
            this.audioChunks = [];
            // Here you would typically send the audio to other participants
            this.addMessage("Audio dikirim ke peserta lain");
          };
        }

        toggleMic() {
          this.isMuted = !this.isMuted;
          const micBtn = document.getElementById("micBtn");

          if (this.isMuted) {
            micBtn.classList.add("muted");
            micBtn.textContent = "üîá";
            if (this.mediaRecorder && this.isRecording) {
              this.mediaRecorder.stop();
              this.isRecording = false;
            }
            this.addMessage("Mikrofon dimatikan");
          } else {
            micBtn.classList.remove("muted");
            micBtn.textContent = "üé§";
            if (this.mediaRecorder && !this.isRecording) {
              this.mediaRecorder.start();
              this.isRecording = true;
            }
            this.addMessage("Mikrofon dinyalakan");
          }

          if (this.currentUser) {
            this.currentUser.isMuted = this.isMuted;
            this.participants.set(this.currentUser.id, this.currentUser);
            this.updateParticipantList();
          }
        }

        toggleSpeaker() {
          this.isSpeakerOn = !this.isSpeakerOn;
          const speakerBtn = document.getElementById("speakerBtn");

          if (this.isSpeakerOn) {
            speakerBtn.classList.remove("muted");
            speakerBtn.textContent = "üîä";
            speakerBtn.style.background =
              "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)";
            this.addMessage("Speaker dinyalakan");
          } else {
            speakerBtn.classList.add("muted");
            speakerBtn.textContent = "üîá";
            speakerBtn.style.background =
              "linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)";
            this.addMessage("Speaker dimatikan");
          }
        }

        updateParticipantList() {
          const participantList = document.getElementById("participantList");
          const participantCount = document.getElementById("participantCount");

          participantList.innerHTML = "";
          participantCount.textContent = this.participants.size;

          this.participants.forEach((participant) => {
            const participantEl = document.createElement("div");
            participantEl.className = "participant";
            participantEl.setAttribute("data-participant-id", participant.id);

            participantEl.innerHTML = `
                        <div class="status-indicator ${
                          participant.isMuted ? "muted" : ""
                        }"></div>
                        <div class="participant-name">${participant.name}</div>
                        <div class="participant-status">
                            ${participant.isMuted ? "üîá Mute" : "üé§ Aktif"}
                        </div>
                    `;

            participantList.appendChild(participantEl);
          });
        }

        leaveChat() {
          if (this.currentUser) {
            this.addMessage(`${this.currentUser.name} meninggalkan room`);
            this.participants.delete(this.currentUser.id);
          }

          document.getElementById("chatSection").classList.remove("active");
          document.getElementById("loginSection").classList.remove("hidden");

          // Reset form
          document.getElementById("usernameInput").value = "";

          // Stop recording if active
          if (this.mediaRecorder && this.isRecording) {
            this.mediaRecorder.stop();
          }

          this.currentUser = null;
          this.isMuted = true;
          this.isSpeakerOn = true;

          // Reset buttons
          const micBtn = document.getElementById("micBtn");
          const speakerBtn = document.getElementById("speakerBtn");

          micBtn.classList.add("muted");
          micBtn.textContent = "üîá";

          speakerBtn.classList.remove("muted");
          speakerBtn.textContent = "üîä";
          speakerBtn.style.background =
            "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)";
        }
      }

      // Initialize the app
      const voiceChat = new VoiceGroupChat();

      // Global functions
      function joinChat() {
        const username = document.getElementById("usernameInput").value.trim();
        if (username) {
          voiceChat.joinChat(username);
        } else {
          alert("Silakan masukkan nama Anda terlebih dahulu");
        }
      }

      function toggleMic() {
        voiceChat.toggleMic();
      }

      function toggleSpeaker() {
        voiceChat.toggleSpeaker();
      }

      function leaveChat() {
        if (confirm("Apakah Anda yakin ingin keluar dari room?")) {
          voiceChat.leaveChat();
        }
      }

      // Enter key support for username input
      document
        .getElementById("usernameInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            joinChat();
          }
        });
    </script>
  </body>
</html>
